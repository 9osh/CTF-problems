from Crypto.Util.number import *
from sympy import *
import random
import primefac
def generate_ecc_parameters():
    x = random.randint(1, 1 << 512)
    y = random.randint(1, 1 << 512)
    return x, y

def find_prime_on_curve(x, y, a, b, ecc_p):
    p = x
    q = y
    while not (isprime(p) and isprime(q)) or n != q*p:
        p = nextprime(p)
        q = (p**3 + a * p + b) % ecc_p
        print(f"p= {p}\nq= {q}\n")
    return p, q

def generate_rsa_parameters():
    ecc_p = P
    x, y = generate_ecc_parameters()
    p, q = find_prime_on_curve(x, y, a, b, ecc_p)
    print(f"p= {p}\nq= {q}\nn= {n}")
    print(f"a= {a}\nb= {b}")
    print(f"P= {ecc_p}")
    

#n = p*q
#m = bytes_to_long(flag)
#c = pow(m,e,n)
#print(c)
e = 9
n= 23298836191712395990541254600776262066247692725919114528027158820049802443474994576179738462067629079873633948850637889127452791527914591229415148712172587856497614285410824614070907847594399218298016379507879066220104597707859246179921731928508884947347652904142879813069359815823184922170241099916465722623
a= 7388665644223916915334064243181348811184637180763467245762518813757790945069068654378380490110607063038613823004593920489924786053478102905200169738195523
b= 11742940161647091720180482697980016011774828087234021441133595442949631197989696508358388255191793888646498553804646435609849154496274569000398776043150743
P= 11300086101709077144191286182913849072593185125745291892398153828719453495325025227858328617077648296782357912556752467026523366682963139253552060862229027
c= 9314530945343661153059846131608414257092556390479105017633636336832925597262814680689800448223193301814365726128618348603188219757245073917910487794768758461683644600756896595336654006282030911824869219015400826589122838492456940861634378619000373353637666835642505021355710338342048772713981673863167110471
p = 2925490712948356009205547798331037409204468852265154197929696123102317330847028997592576845375767951888373634075473448002921250636926630905567362014595493
q = n // p
assert(isprime(p) and isprime(q))
phi = (p - 1) * (q - 1)

import gmpy2
g = gmpy2.gcd(e,phi)
print(g)
print(((p - 1) % g == 0))
d = primefac.modinv(e, q - 1)
m = pow(c,d,q)
#res = gmpy2.iroot(m, g)
print(long_to_bytes(m))
'''
d = primefac.modinv(e, phi//3)
print(long_to_bytes(pow(c,d,n)))
'''
